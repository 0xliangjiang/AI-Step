services:
  # 后端服务
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    container_name: ai-step-backend
    restart: unless-stopped
    environment:
      - MYSQL_HOST=${MYSQL_HOST}
      - MYSQL_PORT=${MYSQL_PORT:-3306}
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE:-ai_step}
      - AI_PROVIDER=${AI_PROVIDER:-minimax}
      - MINIMAX_API_KEY=${MINIMAX_API_KEY:-}
      - MINIMAX_GROUP_ID=${MINIMAX_GROUP_ID:-}
      - GLM_API_KEY=${GLM_API_KEY:-}
      - ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}
      - ADMIN_SECRET_KEY=${ADMIN_SECRET_KEY:-ai-step-admin-secret-key-2024}
      - USE_PROXY=${USE_PROXY:-true}
      - PROXY_API_URL=${PROXY_API_URL:-}
      - APP_DEBUG=${APP_DEBUG:-false}
    networks:
      - ai-step-network

  # 前端服务
  frontend:
    build:
      context: frontend
      dockerfile: Dockerfile
    container_name: ai-step-frontend
    restart: unless-stopped
    ports:
      - "8001:80"
    depends_on:
      - backend
    networks:
      - ai-step-network

networks:
  ai-step-network:
    driver: bridge
